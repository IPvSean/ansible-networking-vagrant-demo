firewall {
    group {
        {% for dict in acl_data[inventory_hostname] -%}
        network-group {{ dict["name"] }}
            {% if tower_top_level_ipv4_dst is defined -%}
            network {{ dict["tower_top_level_ipv4_dst"] }}
            {% else -%}
            network {{ dict["ipv4_network_dest"] }}
            {% endif -%}
        {% endfor -%}
        }
    }
    {% for dict in acl_data[inventory_hostname] -%}
    name {{ dict["name"] }}
        rule {{ dict["sequence"] }} {
            action {{ dict["action"] }}
            destination {
                group {
                    network-group {{ dict["name"] }}
                }
            }
            protocol {{ dict["protocol"] }}
        }
    }
    {% endfor -%}
}

interfaces {
    {% for dict in acl_data[inventory_hostname] -%}
    {% for interface in dict["interfaces"] -%}
    ethernet {{ interface }} {
        firewall {
            local {
                name {{ dict["name"] }}
            }
        }
    }
    {% endfor -%}
    {% endfor -%}
}
